<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Privater Chat mit Firebase</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    #chat { display: none; margin-top: 20px; }
    #messages { border: 1px solid #ccc; padding: 10px; height: 200px; overflow-y: auto; margin-bottom: 10px; white-space: pre-wrap; }
  </style>
</head>
<body>
  <h1>Login</h1>

  <input type="text" id="username" placeholder="Benutzername">
  <input type="password" id="password" placeholder="Passwort">
  <button onclick="login()">Einloggen</button>

  <div id="welcome"></div>

  <div id="chat">
    <h2>Privater Chat</h2>
    <div id="messages">Noch keine Nachrichten.</div>
    <input type="text" id="messageInput" placeholder="Nachricht">
    <button onclick="sendMessage()">Senden</button>
  </div>

  <script>
    const DB_URL = "https://YOUR_FIREBASE_URL/messages.json"; // <== DEIN LINK HIER
    const users = {
      "user1": "pass1",
      "user2": "pass2"
    };

    let currentUser = null;

    function login() {
      const username = document.getElementById("username").value.trim();
      const password = document.getElementById("password").value.trim();

      if (users[username] && users[username] === password) {
        currentUser = username;
        document.getElementById("welcome").textContent = `Willkommen, ${username}!`;
        document.getElementById("chat").style.display = "block";
        loadMessages();
        setInterval(loadMessages, 5000); // Alle 5 Sekunden aktualisieren
      } else {
        alert("Benutzername oder Passwort ist falsch.");
      }
    }

    function sendMessage() {
      const input = document.getElementById("messageInput");
      const text = input.value.trim();
      if (!text) return;

      const message = {
        user: currentUser,
        text: text,
        timestamp: Date.now()
      };

      fetch(DB_URL, {
        method: "POST",
        body: JSON.stringify(message)
      }).then(() => {
        input.value = "";
        loadMessages();
      });
    }

    function loadMessages() {
      fetch(DB_URL)
        .then(res => res.json())
        .then(data => {
          let messages = [];
          for (let key in data) {
            if (data[key].user && data[key].text) {
              messages.push({ ...data[key], key });
            }
          }

          // Sortieren nach Zeit
          messages.sort((a, b) => a.timestamp - b.timestamp);

          // Nur die letzten 5 behalten
          if (messages.length > 5) {
            const toDelete = messages.slice(0, messages.length - 5);
            toDelete.forEach(m => {
              fetch("https://chat-586a3-default-rtdb.europe-west1.firebasedatabase.app/messages.json" + m.key + ".json", {
                method: "DELETE"
              });
            });
            messages = messages.slice(-5);
          }

          // Anzeigen
          const msgDiv = document.getElementById("messages");
          msgDiv.textContent = "";
          messages.forEach(msg => {
            msgDiv.textContent += msg.user + ": " + msg.text + "\n";
          });
        });
    }
  </script>
</body>
</html>
